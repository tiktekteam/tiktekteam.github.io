<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>פלטפורמת סימולציות</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden; /* Ensure no content bleeds outside rounded corners */
        }

        h1 {
            color: #0056b3;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2em;
        }

        .simulations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .simulation-card {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .simulation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .simulation-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: transparent;
            transition: background-color 0.2s ease;
            pointer-events: none;
            border-radius: 8px;
        }

        .simulation-card a {
            display: flex;
            padding: 20px;
            text-decoration: none;
            color: #333;
            font-weight: bold;
            font-size: 1.1em;
            text-align: center;
            justify-content: center;
            align-items: center;
            min-height: 60px;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.05);
            position: relative;
        }

        /* Visual indicator that cards are clickable */
        .simulation-card a::after {
            content: '›';
            position: absolute;
            right: 15px;
            font-size: 1.5em;
            color: #0056b3;
            opacity: 0.7;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .simulation-card:hover a::after {
            transform: translateX(3px);
            opacity: 1;
        }

        .simulation-card a:hover {
            background-color: #e9ecef;
        }

        .simulation-card:active::after {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .intro {
            margin-bottom: 30px;
            text-align: center;
            font-size: 1.1em;
            color: #555;
        }

        footer {
            margin-top: 40px;
            text-align: center;
            color: #6c757d;
            font-size: 0.9em;
        }

        /* Styles for touch devices */
        @media (hover: none) {
            .simulation-card:hover {
                transform: none;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            }

            .simulation-card a:active {
                background-color: #e9ecef;
            }

            .simulation-card:active {
                transform: translateY(-3px);
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            }

            /* Adjust the visual indicator for touch devices */
            .simulation-card:hover a::after {
                transform: none;
                opacity: 0.7;
            }

            .simulation-card:active a::after {
                transform: translateX(3px);
                opacity: 1;
            }
        }

        /* Medium devices (tablets, less than 992px) */
        @media (max-width: 992px) {
            .simulations-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }

        /* Medium devices (tablets, less than 768px) */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.8em;
                margin-bottom: 20px;
            }

            .simulations-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .simulation-card a {
                padding: 15px;
                font-size: 1.05em;
            }

            .intro {
                margin-bottom: 20px;
            }
        }

        /* Small devices (landscape phones, less than 576px) */
        @media (max-width: 576px) {
            body {
                padding: 8px;
            }

            .container {
                padding: 15px;
                border-radius: 8px;
            }

            h1 {
                font-size: 1.6em;
                margin-bottom: 15px;
            }

            .intro {
                font-size: 1em;
                margin-bottom: 15px;
            }

            .simulation-card {
                border-radius: 6px;
            }

            .simulation-card a {
                padding: 12px;
                font-size: 1em;
            }

            /* Adjust indicator position for smaller screens */
            .simulation-card a::after {
                right: 10px;
                font-size: 1.3em;
            }

            footer {
                margin-top: 25px;
                font-size: 0.85em;
            }
        }

        /* Extra small devices (phones, less than 480px) */
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }

            .container {
                padding: 12px;
                border-radius: 6px;
            }

            h1 {
                font-size: 1.4em;
                margin-bottom: 12px;
            }

            .intro {
                font-size: 0.95em;
                margin-bottom: 12px;
            }

            .simulation-card a {
                padding: 10px;
            }

            /* Further adjust indicator for very small screens */
            .simulation-card a::after {
                right: 8px;
                font-size: 1.2em;
            }

            footer {
                margin-top: 20px;
                font-size: 0.8em;
            }
        }

        /* Landscape orientation on mobile */
        @media (max-height: 480px) and (orientation: landscape) {
            .container {
                padding: 10px 15px;
            }

            h1 {
                font-size: 1.3em;
                margin-bottom: 10px;
            }

            .intro {
                margin-bottom: 10px;
            }

            .simulations-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                margin-top: 15px;
            }

            .simulation-card a {
                padding: 8px;
                font-size: 0.95em;
            }

            /* Adjust indicator for landscape orientation */
            .simulation-card a::after {
                right: 5px;
                font-size: 1.1em;
            }

            footer {
                margin-top: 15px;
            }
        }

        /* Add support for high-resolution screens */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            body {
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>פלטפורמת סימולציות</h1>

        <div class="intro">
            <p>ברוכים הבאים לפלטפורמת הסימולציות. בחרו סימולציה מהרשימה למטה כדי להתחיל.</p>
        </div>

        <div class="simulations-grid">
            <div class="simulation-card">
                <a href="simulations/parabole-meets-different-lines.html">פרבולה פוגשת ישרים שונים</a>
            </div>

            <div class="simulation-card">
                <a href="simulations/subtracting-negative-number.html">חיסור במספר שלילי</a>
            </div>

            <!-- Additional simulations will be added here automatically when pushed to GitHub -->
        </div>

        <footer>
            <p>סימולציות נוספות יתווספו בהמשך. הדף מתעדכן אוטומטית כאשר קבצים חדשים נוספים לתיקיית הסימולציות.</p>
        </footer>
    </div>

    <script>
        // Register service worker for offline support and caching
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }

        // This script will run when the page loads to check for new simulations
        document.addEventListener('DOMContentLoaded', function() {
            // Function to create a simulation card
            function createSimulationCard(href, title) {
                const card = document.createElement('div');
                card.className = 'simulation-card';

                const link = document.createElement('a');
                link.href = href;
                link.textContent = title;

                card.appendChild(link);
                return card;
            }

            // Function to fetch and display simulations
            async function loadSimulations() {
                try {
                    const simulationsGrid = document.querySelector('.simulations-grid');

                    // Clear existing cards
                    simulationsGrid.innerHTML = '';

                    // Get the current hostname and protocol for GitHub Pages compatibility
                    const baseUrl = window.location.origin;

                    // Fetch the list of HTML files in the simulations directory
                    try {
                        // First, try to use the GitHub API if we're on GitHub Pages
                        // Extract username and repo name from the URL if on GitHub Pages
                        const ghPagesRegex = /https?:\/\/([^.]+)\.github\.io\/([^/]+)/;
                        const ghMatch = window.location.href.match(ghPagesRegex);

                        if (ghMatch) {
                            const username = ghMatch[1];
                            const repoName = ghMatch[2];
                            const path = 'simulations';

                            console.log(`Detected GitHub Pages: ${username}/${repoName}`);

                            // Use GitHub API to get directory contents
                            const apiUrl = `https://api.github.com/repos/${username}/${repoName}/contents/${path}`;
                            const response = await fetch(apiUrl);

                            if (response.ok) {
                                const files = await response.json();

                                // Process each HTML file
                                const processPromises = files
                                    .filter(file => file.name.endsWith('.html'))
                                    .map(async file => {
                                        try {
                                            // Fetch the HTML file to extract its title
                                            const htmlResponse = await fetch(file.download_url);
                                            const html = await htmlResponse.text();

                                            // Parse the HTML to get the title
                                            const parser = new DOMParser();
                                            const doc = parser.parseFromString(html, 'text/html');
                                            const title = doc.querySelector('title')?.textContent || file.name;

                                            // Create and add the card
                                            const card = createSimulationCard(`${path}/${file.name}`, title);
                                            simulationsGrid.appendChild(card);
                                        } catch (err) {
                                            console.error(`Error processing file ${file.name}:`, err);
                                            // Add card with filename as fallback
                                            const card = createSimulationCard(`${path}/${file.name}`, file.name);
                                            simulationsGrid.appendChild(card);
                                        }
                                    });

                                await Promise.all(processPromises);
                                return; // Exit if GitHub API method succeeded
                            }
                        }
                    } catch (githubError) {
                        console.warn('GitHub API method failed, falling back to known simulations:', githubError);
                    }

                    // Fallback: Try to dynamically discover simulation files
                    console.log('Attempting to dynamically discover simulation files...');

                    // Start with known simulations as a base
                    const knownSimulations = [
                        { path: 'simulations/parabole-meets-different-lines.html', title: 'פרבולה פוגשת ישרים שונים' },
                        { path: 'simulations/subtracting-negative-number.html', title: 'חיסור במספר שלילי' },
                        { path: 'simulations/test.html', title: 'בדיקה' }
                    ];

                    // Add known simulations first
                    knownSimulations.forEach(sim => {
                        const card = createSimulationCard(sim.path, sim.title);
                        simulationsGrid.appendChild(card);
                    });

                    // Then try to discover additional simulations
                    discoverSimulations();
                } catch (error) {
                    console.error('Error loading simulations:', error);
                }
            }

            // Function to dynamically discover simulation files
            async function discoverSimulations() {
                try {
                    const simulationsGrid = document.querySelector('.simulations-grid');
                    const existingPaths = new Set(
                        Array.from(simulationsGrid.querySelectorAll('a')).map(a => a.getAttribute('href'))
                    );

                    // First, check for test2.html specifically (mentioned in the issue)
                    await checkAndAddFile('test2.html', existingPaths, simulationsGrid);

                    // Then check for other numbered test files
                    for (let i = 1; i <= 10; i++) {
                        const fileName = `test${i}.html`;
                        // Skip test.html since it's already in the known simulations
                        if (fileName === 'test1.html') continue;

                        const filePath = `simulations/${fileName}`;

                        // Skip if this file is already in the grid
                        if (existingPaths.has(filePath)) {
                            continue;
                        }

                        try {
                            // Try to fetch the file to see if it exists
                            const response = await fetch(filePath, { method: 'HEAD' });

                            if (response.ok) {
                                console.log(`Discovered new simulation file: ${filePath}`);

                                // Fetch the full file to extract the title
                                const htmlResponse = await fetch(filePath);
                                const html = await htmlResponse.text();

                                // Parse the HTML to get the title
                                const parser = new DOMParser();
                                const doc = parser.parseFromString(html, 'text/html');
                                const title = doc.querySelector('title')?.textContent || fileName;

                                // Create and add the card
                                const card = createSimulationCard(filePath, title);
                                simulationsGrid.appendChild(card);

                                // Update the service worker cache if possible
                                updateServiceWorkerCache(filePath);

                                // Add to existing paths to avoid duplicates
                                existingPaths.add(filePath);
                            }
                        } catch (error) {
                            // Silently continue if file not found
                        }
                    }

                    // Try to discover files by scanning the directory
                    try {
                        // Try to fetch a directory listing if available
                        // This won't work in most browsers due to security restrictions,
                        // but it's worth trying in case the server supports directory listings
                        const response = await fetch('simulations/');

                        if (response.ok) {
                            const html = await response.text();

                            // Parse the HTML to look for links to HTML files
                            const parser = new DOMParser();
                            const doc = parser.parseFromString(html, 'text/html');
                            const links = doc.querySelectorAll('a');

                            // Check each link to see if it points to an HTML file
                            for (const link of links) {
                                const href = link.getAttribute('href');
                                if (href && href.endsWith('.html')) {
                                    // Extract the filename
                                    const fileName = href.split('/').pop();
                                    const filePath = `simulations/${fileName}`;

                                    // Skip if this file is already in the grid
                                    if (existingPaths.has(filePath)) {
                                        continue;
                                    }

                                    try {
                                        // Fetch the full file to extract the title
                                        const htmlResponse = await fetch(filePath);
                                        const html = await htmlResponse.text();

                                        // Parse the HTML to get the title
                                        const parser = new DOMParser();
                                        const doc = parser.parseFromString(html, 'text/html');
                                        const title = doc.querySelector('title')?.textContent || fileName;

                                        // Create and add the card
                                        const card = createSimulationCard(filePath, title);
                                        simulationsGrid.appendChild(card);

                                        // Update the service worker cache if possible
                                        updateServiceWorkerCache(filePath);

                                        // Add to existing paths to avoid duplicates
                                        existingPaths.add(filePath);
                                    } catch (error) {
                                        // Silently continue if file not found
                                    }
                                }
                            }
                        }
                    } catch (error) {
                        console.log('Directory listing not available or error scanning directory:', error.message);
                    }
                } catch (error) {
                    console.error('Error discovering simulations:', error);
                }
            }

            // Helper function to check if a file exists and add it to the grid
            async function checkAndAddFile(fileName, existingPaths, simulationsGrid) {
                const filePath = `simulations/${fileName}`;

                // Skip if this file is already in the grid
                if (existingPaths.has(filePath)) {
                    console.log(`File ${filePath} already in grid, skipping`);
                    return false;
                }

                try {
                    // Try to fetch the file to see if it exists
                    const response = await fetch(filePath, { method: 'HEAD' });

                    if (response.ok) {
                        console.log(`Discovered new simulation file: ${filePath}`);

                        // Fetch the full file to extract the title
                        const htmlResponse = await fetch(filePath);
                        const html = await htmlResponse.text();

                        // Parse the HTML to get the title
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        const title = doc.querySelector('title')?.textContent || fileName;

                        // Create and add the card
                        const card = createSimulationCard(filePath, title);
                        simulationsGrid.appendChild(card);

                        // Update the service worker cache if possible
                        updateServiceWorkerCache(filePath);

                        // Add to existing paths to avoid duplicates
                        existingPaths.add(filePath);

                        return true; // File was found and added
                    }
                } catch (error) {
                    console.log(`File ${filePath} not found or error fetching: ${error.message}`);
                }

                return false; // File was not found or not added
            }

            // Function to update the service worker cache with a new file
            function updateServiceWorkerCache(filePath) {
                if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                    // Send a message to the service worker to cache the new file
                    navigator.serviceWorker.controller.postMessage({
                        type: 'CACHE_NEW_FILE',
                        url: filePath
                    });
                    console.log(`Requested service worker to cache: ${filePath}`);
                }
            }

            // Load simulations when the page loads
            loadSimulations();
        });
    </script>
</body>
</html>
